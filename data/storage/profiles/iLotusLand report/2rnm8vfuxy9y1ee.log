{"type":"operationStart","subtype":"profile","data":{"_id":"Zi0baTtm72Y1Peof","timestamp":"2023-08-17T07:21:59.061Z","state":"queued","mode":"standard","creationDate":"2023-08-17T07:21:59.115Z","modificationDate":"2023-08-17T07:21:59.115Z","shortid":"0O9AlG7","$entitySet":"profiles"},"doDiffs":false,"timestamp":1692256919077,"id":"ywiwchf15lw505d","previousOperationId":null,"operationId":"j2nsye2ya7uzzf7"}
{"type":"log","level":"info","message":"Render request 1 queued for execution and waiting for available worker","previousOperationId":"j2nsye2ya7uzzf7","timestamp":1692256919078,"id":"npme1aof475z409"}
{"type":"operationStart","subtype":"render","name":"iLotusLand report","previousOperationId":"j2nsye2ya7uzzf7","timestamp":1692256919287,"id":"i8tr7u4ypnmul0g","previousEventId":"ywiwchf15lw505d","operationId":"enya9r54tb8d58v"}
{"type":"log","timestamp":1692256919291,"level":"info","message":"Starting rendering request 1","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"ii4km6cz5f3b350","previousOperationId":"enya9r54tb8d58v"}
{"type":"log","timestamp":1692256919298,"level":"info","message":"Rendering template { name: iLotusLand report, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"ezo1j4r00824kc1","previousOperationId":"enya9r54tb8d58v"}
{"type":"log","timestamp":1692256919299,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"9gzdqkbin6j8t4n","previousOperationId":"enya9r54tb8d58v"}
{"type":"log","timestamp":1692256919982,"level":"debug","message":"Executing script ill-script (beforeRender)","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"bh6ktc9d7iw94qp","previousOperationId":"enya9r54tb8d58v"}
{"type":"operationStart","subtype":"scriptsBeforeRender","name":"scripts beforeRender","timestamp":1692256923566,"id":"2h018fhhpi46q3x","previousEventId":"i8tr7u4ypnmul0g","operationId":"nhxzy55292bhwih","previousOperationId":"enya9r54tb8d58v"}
{"type":"operationStart","subtype":"script","name":"scripts ill-script","previousOperationId":"nhxzy55292bhwih","timestamp":1692256923566,"id":"uj9jk54ine175nj","previousEventId":"2h018fhhpi46q3x","operationId":"ayp9tavrrmf6kla"}
{"type":"log","timestamp":1692256923575,"level":"warn","message":"Error when processing render request 1\n(because) error when evaluating custom script /ill-script\na is not defined\n\n(sandbox.js line 52:5)\n\n  50 |\n  51 | async function beforeRender(req, res) {\n> 52 |     a()\n     |     ^\n  53 |     console.log(\"Before render.....\")\n  54 |     req.stations = await prepareData()\n  55 | }\n\n(sandbox.js line 67:18)\nReferenceError: a is not defined\n    at Object.beforeRender (sandbox.js:52:5)\n    at executionFn (/Users/admin/Desktop/research/jsreport/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:35)\n    at sandbox.js:67:18","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"7xdbq0rs297q8vf","previousOperationId":"ayp9tavrrmf6kla"}
{"type":"log","timestamp":1692256923575,"level":"warn","message":"Rendering request 1 finished with error in 4515 ms","meta":{"rootId":"2rnm8vfuxy9y1ee","id":"2rnm8vfuxy9y1ee"},"id":"bes1lxchug7ngfk","previousOperationId":"ayp9tavrrmf6kla"}
{"type":"error","timestamp":1692256923583,"statusCode":400,"weak":true,"lineNumber":52,"decoratedSuffix":"\n\n(sandbox.js line 52:5)\n\n  50 |\n  51 | async function beforeRender(req, res) {\n> 52 |     a()\n     |     ^\n  53 |     console.log(\"Before render.....\")\n  54 |     req.stations = await prepareData()\n  55 | }\n\n(sandbox.js line 67:18)","entity":{"shortid":"vivaZZXxUu","name":"ill-script","content":"// server side script fetching remote data and preparing report data source\nconst https = require('https');\n\nconst END_POINT = 'https://demo-api.ilotusland.asia/station-auto/last-log';\nconst CUSTOM_HEADER = {\n    'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDE5MGI3ZWZjMzgzMDAwMWJmMTAxNWUiLCJmaXJzdE5hbWUiOiJNaW5oIiwibGFzdE5hbWUiOiLEkOG7lyIsImlzQWRtaW4iOnRydWUsImlzQWN0aXZlIjpmYWxzZSwiaXNPd25lciI6dHJ1ZSwib3JnYW5pemF0aW9uIjp7Il9pZCI6IjVlZWY4MDExOWQ0ZjQ1MDAxMWMzMGQ1OSIsIm5hbWUiOiJpTG90dXNMYW5kIFZpZXQgTmFtIEpTQy4ifSwiaWF0IjoxNjkwOTU3OTk0fQ.x2abIiIwQf8tXlqYIUZ2EUdw9sIwwt1TG7ZE-hxs7Eo',\n};\n\nfunction fetchData() {\n    return new Promise((resolve, reject) => {\n        const options = {\n            headers: CUSTOM_HEADER\n        };\n\n        https.get(END_POINT, options, (result) => {\n            var str = '';\n\n            result.on('data', (b) => {\n                str = b.toString(); // Convert the received data chunk to a string\n            });\n\n            result.on('error', reject);\n\n            result.on('end', () => {\n                try {\n                    const data = JSON.parse(str).value;\n                    resolve(data);\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        });\n\n    });\n}\n\nconst prepareData = async() => {\n    const data = await fetchData()\n    let stations = data.data\n    stations = stations.map(station => {\n        return {\n            name: station.name,\n            data: station.lastlog.measuringLogs\n        }\n    })\n    console.log(stations,'stationsstations')\n    return stations\n}\n\n\nasync function beforeRender(req, res) {\n    a()\n    console.log(\"Before render.....\")\n    req.stations = await prepareData()\n}"},"property":"content","logged":true,"previousOperationId":"ayp9tavrrmf6kla","id":"ghdbyizfeqj0vfa","stack":"ReferenceError: a is not defined\n    at Object.beforeRender (sandbox.js:52:5)\n    at executionFn (/Users/admin/Desktop/research/jsreport/node_modules/@jsreport/jsreport-scripts/lib/executeScript.js:67:35)\n    at sandbox.js:67:18","message":"Error when evaluating custom script /ill-script\na is not defined\n\n(sandbox.js line 52:5)\n\n  50 |\n  51 | async function beforeRender(req, res) {\n> 52 |     a()\n     |     ^\n  53 |     console.log(\"Before render.....\")\n  54 |     req.stations = await prepareData()\n  55 | }\n\n(sandbox.js line 67:18)"}
